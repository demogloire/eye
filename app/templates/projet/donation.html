{% extends "layout/emi.html" %}

{% block css %}
     
<style>
/* --- Card1 ---- */

.Card1 {
  position: relative;
  background: #fff;
  margin: 1em;
  display: inline-block;
  text-align: left;
  overflow: hidden;
  font-size: 14px;
  border-radius: 3px;
  height: auto;
  max-width: auto;
  -moz-transition: 0.5s;-o-transition: 0.5s;-webkit-transition: 0.5s;transition: 0.5s;
  -webkit-box-shadow: 0 3px 7px -3px rgba(0, 0, 0, 0.3);-moz-box-shadow: 0 3px 7px -3px rgba(0, 0, 0, 0.3);box-shadow: 0 3px 7px -3px rgba(0, 0, 0, 0.3);
}

.Card1 .photo {
  position: relative;
  -moz-transition: 0.5s;-o-transition: 0.5s;-webkit-transition: 0.5s;transition: 0.5s;
  float: left;
  height: 100%;
  width: 40%;
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  background-image:url("{{url_for('static', filename='rubrique/{}'.format(session['image_rub']))}}");
}
.Card1:hover .photo {
  -webkit-transform: rotate(5deg) scale(1.3);-moz-transform: rotate(5deg) scale(1.3);-ms-transform: rotate(5deg) scale(1.3);-o-transform: rotate(5deg) scale(1.3);transform: rotate(5deg) scale(1.3);
}

.Card1 .details {
  -moz-transition: 0.5s;-o-transition: 0.5s;-webkit-transition: 0.5s;transition: 0.5s;
  background: rgba(0, 0, 0, 0.6);
  color: #fff;
  list-style: none;
  margin: 0px;
  padding: 1em;
  height: 100%;
  position: absolute;
  top: 0px;
  left: -100%;
  width: 40%;
}
.Card1:hover .details {left: 0px;}
.Card1:hover .details li{padding: 0.1em;}

.Card1 .description{
  padding: 1em;
  position: relative;
  float: right;
  height: 100%;
  width: 60%;
  z-index: 0;
}
.Card1 .description:before {
  content: "";
  background: #fff;
  width: 100%;
  z-index: -1;
  position: absolute;
  left: -15px;
  top: 0;
  bottom: 0;
  -webkit-transform: skewX(-5deg);-moz-transform: skewX(-5deg);-ms-transform: skewX(-5deg);-o-transform: skewX(-5deg);transform: skewX(-5deg);
}

.Card1 .description h1 {
  font-size: 2em;
  padding: 0.5em 0px;
  font-weight: bold;
}
.Card1 .description .line {display: block;height: 5em;}
.Card1 .description .product_name {float: left;}
.Card1 .description .product_price {float: right;color:#4cbc32;}
.Card1 .description h2 {
  color: #9b9b9b;
  font-weight: lighter;
  text-transform: uppercase;
  font-size: 0.9em;
  font-weight: 400;
}
.Card1 .description p {position: relative;padding: 2em 0px 1em 0.5em;}

.Card1 .description p:after {
  content: "";
  background: #75D13B;
  height: 6px;
  width: 5em;
  position: absolute;
  top: 0.6em;
  left: 0px;
}

.close { cursor: pointer; }.close { cursor: pointer; }


</style>
{% endblock %}



{% block body %}

{% include 'element/menu.html'%}



<section class="hero-wrap hero-wrap-2" style="background-image: url('{{url_for('static', filename='emi/images/bg_2.jpg')}}');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text align-items-end">
            <div class="col-md-9 ftco-animate pb-5">
                <p class="breadcrumbs mb-2">
                    <span class="mr-2">
                        <a href="{{url_for('projet.accueil')}}">Home
                            <i class="ion-ios-arrow-forward"></i>
                        </a>
                    </span>
                    <span>Donate
                        <i class="ion-ios-arrow-forward"></i>
                    </span>
                </p>
                <h1 class="mb-0 bread">Donate</h1>
            </div>
        </div>
    </div>
</section>

<section class="ftco-section">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="Card1">
                    <div class="photo"></div>
                    <ul class="details">
                    <h4>Personnel information</h4>
                    <li>{{session['donateur_rub']}}</li>
                    <li>{{session['do_adresse_mail']}}</li>
                    </ul>
                    <div class="description">
                    <div class="line">
                        <h1 class="product_name">{{session['noms_rub']}}</h1>
                        <h1 class="product_price">$ {{session['montant']}} </h1>
                    </div>
                                       
                    {{session['resume']|safe}}

                    <br>
                    <div class="d-flex justify-content-left">
                        <a href=" {{url_for('projet.accueil')}} " class="btn btn-secondary ">Cancel</a>
                    </div>
                    
                    
                </div>
            </div>
        </div>
        <div class="col-md-4">
            {{notification}}
            {%if notification==True%}
                <div class="alert alert-danger alert-dismissible fade show" id='redAlert' role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                    <strong>Thanks</strong> for your contribution !
                </div>

                <div class="d-flex justify-content-center">
                    <p><a href="{{url_for('projet.accueil')}}" class="btn btn-secondary btn-outline-secondary"> Done Donate</a></p>
                </div>
               
            {%else%}
            <div id="paypal-button-container"></div>
            {%endif%}
            
        </div>
    </div>
</section>



<script src="https://www.paypal.com/sdk/js?client-id=AZnijnhEFfRmVNt2Z3y4JnYOFyIhEs3fTvy3DfO8dPL_sLThcbWtq435c4HFcBaTwLcYf5cQiruwmyG7&currency=USD"></script>

    <script>
        
        var csrf_token = "{{ csrf_token() }}";
    
        function completeOrder(name) {
            var url="{{url_for('projet.donation_final')}}"

            fetch(url,{
                method: 'POST',
                headers:{
                    'Content-type':'application/json',
                    'X-CSRFToken': csrf_token,
                },
                body:JSON.stringify({"donnateur":name})

            })

            
        }
        
        // Render the PayPal button into #paypal-button-container
        paypal.Buttons({
            // Set up the transaction
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: {{'{}'.format(session['montant'])}}
                        }
                    }]
                });
            },

            // Finalize the transaction
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    completeOrder(details.payer.name.given_name);
                    
                    window.setTimeout(function(){
                        // Move to a new location or you can do something else
                        location.replace("{{url_for('projet.donation', nopay='b326b5062b2f0e69046810717534cb09')}}");
                    }, 1000); 
                });
            }


        }).render('#paypal-button-container');
    </script>

    <script>
        $('#redAlert').hide();
            window.setTimeout(function() {
            $( "#redAlert" ).fadeIn(1000).slideDown(1000);
            }, 4000);

    </script>
 {%endblock%}